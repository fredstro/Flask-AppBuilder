<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>flask_appbuilder.charts.views &mdash; Flask AppBuilder</title>
    
    <link rel="stylesheet" href="../../../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/bootswatch-3.3.6/flatly/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '1.6.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../../../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../../../_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="Flask AppBuilder" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body role="document">
  
  <a href="https://github.com/dpgaspar/Flask-AppBuilder"
     class="visible-desktop hidden-xs"><img
    id="gh-banner"
    style="position: absolute; top: 50px; right: 0; border: 0;"
    src="https://s3.amazonaws.com/github/ribbons/forkme_right_white_ffffff.png"
    alt="Fork me on GitHub"></a>
  <script>
    // Adjust banner height.
    $(function () {
      var navHeight = $(".navbar .container").css("height");
      $("#gh-banner").css("top", navHeight);
    });
  </script>


  <div id="navbar" class="navbar  navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../../index.html">
          Flask-AppBuilder</a>
        <span class="navbar-text navbar-version pull-left"><b>1.6.1</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../../../diagrams.html">Diagrams</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../../../intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../fabmanager.html">Command Line Manager</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../config.html">Base Configuration</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../views.html">Base Views</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../quickhowto.html">Model Views (Quick How to)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../quickhowto_mongo.html">Model Views on MongoDB</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../quickcharts.html">Chart Views</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../quickfiles.html">Model Views with Files and Images</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../quickminimal.html">Quick Minimal Application</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../relations.html">Model Relations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../actions.html">Actions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../advanced.html">Advanced Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../customizing.html">Customizing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../templates.html">Templates</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../addons.html">AddOn development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../generic_datasource.html">Generic Data Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../multipledbs.html">Multiple Databases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../i18n.html">i18n Translations</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../security.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../user_registration.html">User Registration</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../api.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../versionmigration.html">Version Migration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../versions.html">Versions</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"></ul>
</li>
              
            
            
              
                
              
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <h1>Source code for flask_appbuilder.charts.views</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">flask.ext.babelpkg</span> <span class="kn">import</span> <span class="n">lazy_gettext</span>
<span class="kn">from</span> <span class="nn">.widgets</span> <span class="kn">import</span> <span class="n">ChartWidget</span><span class="p">,</span> <span class="n">DirectChartWidget</span>
<span class="kn">from</span> <span class="nn">.jsontools</span> <span class="kn">import</span> <span class="n">dict_to_json</span>
<span class="kn">from</span> <span class="nn">..widgets</span> <span class="kn">import</span> <span class="n">SearchWidget</span>
<span class="kn">from</span> <span class="nn">..security.decorators</span> <span class="kn">import</span> <span class="n">has_access</span>
<span class="kn">from</span> <span class="nn">..baseviews</span> <span class="kn">import</span> <span class="n">BaseModelView</span><span class="p">,</span> <span class="n">expose</span>
<span class="kn">from</span> <span class="nn">..urltools</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">..models.group</span> <span class="kn">import</span> <span class="n">GroupByProcessData</span><span class="p">,</span> <span class="n">DirectProcessData</span>

<span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>


<div class="viewcode-block" id="BaseChartView"><a class="viewcode-back" href="../../../api.html#flask.ext.appbuilder.charts.views.BaseChartView">[docs]</a><span class="k">class</span> <span class="nc">BaseChartView</span><span class="p">(</span><span class="n">BaseModelView</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This is the base class for all chart views.</span>
<span class="sd">        Use DirectByChartView or GroupByChartView, override their properties and their base classes</span>
<span class="sd">        (BaseView, BaseModelView, BaseChartView) to customise your charts</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">chart_template</span> <span class="o">=</span> <span class="s1">&#39;appbuilder/general/charts/chart.html&#39;</span>
    <span class="sd">&quot;&quot;&quot; The chart template, override to implement your own &quot;&quot;&quot;</span>
    <span class="n">chart_widget</span> <span class="o">=</span> <span class="n">ChartWidget</span>
    <span class="sd">&quot;&quot;&quot; Chart widget override to implement your own &quot;&quot;&quot;</span>
    <span class="n">search_widget</span> <span class="o">=</span> <span class="n">SearchWidget</span>
    <span class="sd">&quot;&quot;&quot; Search widget override to implement your own &quot;&quot;&quot;</span>

    <span class="n">chart_title</span> <span class="o">=</span> <span class="s1">&#39;Chart&#39;</span>
    <span class="sd">&quot;&quot;&quot; A title to be displayed on the chart &quot;&quot;&quot;</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Title&#39;</span>

    <span class="n">group_by_label</span> <span class="o">=</span> <span class="n">lazy_gettext</span><span class="p">(</span><span class="s1">&#39;Group by&#39;</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot; The label that is displayed for the chart selection &quot;&quot;&quot;</span>

    <span class="n">default_view</span> <span class="o">=</span> <span class="s1">&#39;chart&#39;</span>

    <span class="n">chart_type</span> <span class="o">=</span> <span class="s1">&#39;PieChart&#39;</span>
    <span class="sd">&quot;&quot;&quot; The chart type PieChart, ColumnChart, LineChart &quot;&quot;&quot;</span>
    <span class="n">chart_3d</span> <span class="o">=</span> <span class="s1">&#39;true&#39;</span>
    <span class="sd">&quot;&quot;&quot; Will display in 3D? &quot;&quot;&quot;</span>
    <span class="n">width</span> <span class="o">=</span> <span class="mi">400</span>
    <span class="sd">&quot;&quot;&quot; The width &quot;&quot;&quot;</span>
    <span class="n">height</span> <span class="o">=</span> <span class="s1">&#39;400px&#39;</span>

    <span class="n">group_bys</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="sd">&quot;&quot;&quot; New for 0.6.4, on test, don&#39;t use yet &quot;&quot;&quot;</span>


    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_titles</span><span class="p">()</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">BaseChartView</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">_init_titles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_title</span>

    <span class="k">def</span> <span class="nf">_get_chart_widget</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                          <span class="n">widgets</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="k">def</span> <span class="nf">_get_view_widget</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            :return:</span>
<span class="sd">                Returns a widget</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_chart_widget</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;chart&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="GroupByChartView"><a class="viewcode-back" href="../../../api.html#flask.ext.appbuilder.charts.views.GroupByChartView">[docs]</a><span class="k">class</span> <span class="nc">GroupByChartView</span><span class="p">(</span><span class="n">BaseChartView</span><span class="p">):</span>

    <span class="n">definitions</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        These charts can display multiple series,</span>
<span class="sd">        based on columns or methods defined on models.</span>
<span class="sd">        You can display multiple charts on the same view.</span>
<span class="sd">        This data can be grouped and aggregated has you like.</span>

<span class="sd">        :label: (optional) String label to display on chart selection.</span>
<span class="sd">        :group: String with the column name or method from model.</span>
<span class="sd">        :formatter: (optional) function that formats the output of &#39;group&#39; key</span>
<span class="sd">        :series: A list of tuples with the aggregation function and the column name</span>
<span class="sd">                to apply the aggregation</span>

<span class="sd">        ::</span>

<span class="sd">            [{</span>
<span class="sd">                &#39;label&#39;: &#39;String&#39;,</span>
<span class="sd">                &#39;group&#39;: &#39;&lt;COLNAME&gt;&#39;|&#39;&lt;FUNCNAME&gt;&#39;</span>
<span class="sd">                &#39;formatter: &lt;FUNC&gt;</span>
<span class="sd">                &#39;series&#39;: [(&lt;AGGR FUNC&gt;, &lt;COLNAME&gt;|&#39;&lt;FUNCNAME&gt;&#39;),...]</span>
<span class="sd">                }</span>
<span class="sd">            ]</span>

<span class="sd">        example::</span>

<span class="sd">            class CountryGroupByChartView(GroupByChartView):</span>
<span class="sd">                datamodel = SQLAInterface(CountryStats)</span>
<span class="sd">                chart_title = &#39;Statistics&#39;</span>

<span class="sd">            definitions = [</span>
<span class="sd">                {</span>
<span class="sd">                    &#39;label&#39;: &#39;Country Stat&#39;,</span>
<span class="sd">                    &#39;group&#39;: &#39;country&#39;,</span>
<span class="sd">                    &#39;series&#39;: [(aggregate_avg, &#39;unemployed_perc&#39;),</span>
<span class="sd">                           (aggregate_avg, &#39;population&#39;),</span>
<span class="sd">                           (aggregate_avg, &#39;college_perc&#39;)</span>
<span class="sd">                          ]</span>
<span class="sd">                }</span>
<span class="sd">            ]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">chart_type</span> <span class="o">=</span> <span class="s1">&#39;ColumnChart&#39;</span>
    <span class="n">chart_template</span> <span class="o">=</span> <span class="s1">&#39;appbuilder/general/charts/jsonchart.html&#39;</span>
    <span class="n">chart_widget</span> <span class="o">=</span> <span class="n">DirectChartWidget</span>
    <span class="n">ProcessClass</span> <span class="o">=</span> <span class="n">GroupByProcessData</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">GroupByChartView</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">definition</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">definitions</span><span class="p">:</span>
            <span class="n">col</span> <span class="o">=</span> <span class="n">definition</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;group&#39;</span><span class="p">)</span>
            <span class="c1"># Setup labels</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">label_columns</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">definition</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;label&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_columns</span><span class="p">[</span><span class="n">col</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">label_columns</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prettify_column</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">definition</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;label&#39;</span><span class="p">):</span>
                <span class="n">definition</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_columns</span><span class="p">[</span><span class="n">col</span><span class="p">]</span>
            <span class="c1"># Setup Series</span>
            <span class="k">for</span> <span class="n">serie</span> <span class="ow">in</span> <span class="n">definition</span><span class="p">[</span><span class="s1">&#39;series&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">serie</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">serie</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;_label&#39;</span><span class="p">):</span>
                        <span class="n">key</span> <span class="o">=</span> <span class="n">serie</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">__name__</span> <span class="o">+</span> <span class="n">serie</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">label_columns</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> \
                            <span class="n">serie</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_label</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prettify_column</span><span class="p">(</span><span class="n">serie</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">label_columns</span><span class="p">[</span><span class="n">serie</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prettify_column</span><span class="p">(</span><span class="n">serie</span><span class="p">)</span>



<div class="viewcode-block" id="GroupByChartView.get_group_by_class"><a class="viewcode-back" href="../../../api.html#flask.ext.appbuilder.charts.views.GroupByChartView.get_group_by_class">[docs]</a>    <span class="k">def</span> <span class="nf">get_group_by_class</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">definition</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            intantiates the processing class (Direct or Grouped) and returns it.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">group_by</span> <span class="o">=</span> <span class="n">definition</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">]</span>
        <span class="n">series</span> <span class="o">=</span> <span class="n">definition</span><span class="p">[</span><span class="s1">&#39;series&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;formatter&#39;</span> <span class="ow">in</span> <span class="n">definition</span><span class="p">:</span>
            <span class="n">formatter</span> <span class="o">=</span> <span class="p">{</span><span class="n">group_by</span><span class="p">:</span> <span class="n">definition</span><span class="p">[</span><span class="s1">&#39;formatter&#39;</span><span class="p">]}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">formatter</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ProcessClass</span><span class="p">([</span><span class="n">group_by</span><span class="p">],</span> <span class="n">series</span><span class="p">,</span> <span class="n">formatter</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="nf">_get_chart_widget</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                          <span class="n">order_column</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                          <span class="n">order_direction</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                          <span class="n">widgets</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                          <span class="n">direct</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                          <span class="n">height</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                          <span class="n">definition</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                          <span class="o">**</span><span class="n">args</span><span class="p">):</span>

        <span class="n">height</span> <span class="o">=</span> <span class="n">height</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span>
        <span class="n">widgets</span> <span class="o">=</span> <span class="n">widgets</span> <span class="ow">or</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">joined_filters</span> <span class="o">=</span> <span class="n">filters</span><span class="o">.</span><span class="n">get_joined_filters</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_base_filters</span><span class="p">)</span>
        <span class="c1"># check if order_column may be database ordered</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">datamodel</span><span class="o">.</span><span class="n">get_order_columns_list</span><span class="p">([</span><span class="n">order_column</span><span class="p">]):</span>
            <span class="n">order_column</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="n">order_direction</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">count</span><span class="p">,</span> <span class="n">lst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">datamodel</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">filters</span><span class="o">=</span><span class="n">joined_filters</span><span class="p">,</span>
                                          <span class="n">order_column</span><span class="o">=</span><span class="n">order_column</span><span class="p">,</span>
                                          <span class="n">order_direction</span><span class="o">=</span><span class="n">order_direction</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">definition</span><span class="p">:</span>
            <span class="n">definition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">definitions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_group_by_class</span><span class="p">(</span><span class="n">definition</span><span class="p">)</span>
        <span class="n">value_columns</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">group</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">lst</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="n">order_column</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_columns</span><span class="p">)</span>
        <span class="n">widgets</span><span class="p">[</span><span class="s1">&#39;chart&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_widget</span><span class="p">(</span><span class="n">route_base</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">route_base</span><span class="p">,</span>
                                             <span class="n">chart_title</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_title</span><span class="p">,</span>
                                             <span class="n">chart_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span><span class="p">,</span>
                                             <span class="n">chart_3d</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_3d</span><span class="p">,</span>
                                             <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
                                             <span class="n">value_columns</span><span class="o">=</span><span class="n">value_columns</span><span class="p">,</span>
                                             <span class="n">modelview_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span>
                                              <span class="o">**</span><span class="n">args</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">widgets</span>

    <span class="nd">@expose</span><span class="p">(</span><span class="s1">&#39;/chart/&lt;group_by&gt;&#39;</span><span class="p">)</span>
    <span class="nd">@expose</span><span class="p">(</span><span class="s1">&#39;/chart/&#39;</span><span class="p">)</span>
    <span class="nd">@has_access</span>
    <span class="k">def</span> <span class="nf">chart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group_by</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="n">group_by</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">group_by</span><span class="p">)</span>
        <span class="n">form</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_form</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
        <span class="n">get_filter_args</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filters</span><span class="p">)</span>
        <span class="n">widgets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_chart_widget</span><span class="p">(</span><span class="n">filters</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_filters</span><span class="p">,</span>
                                         <span class="n">definition</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">definitions</span><span class="p">[</span><span class="n">group_by</span><span class="p">],</span>
                                         <span class="n">order_column</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">definitions</span><span class="p">[</span><span class="n">group_by</span><span class="p">][</span><span class="s1">&#39;group&#39;</span><span class="p">],</span>
                                         <span class="n">order_direction</span><span class="o">=</span><span class="s1">&#39;asc&#39;</span><span class="p">)</span>
        <span class="n">widgets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_search_widget</span><span class="p">(</span><span class="n">form</span><span class="o">=</span><span class="n">form</span><span class="p">,</span> <span class="n">widgets</span><span class="o">=</span><span class="n">widgets</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_redirect</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">render_template</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_template</span><span class="p">,</span> <span class="n">route_base</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">route_base</span><span class="p">,</span>
                               <span class="n">title</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_title</span><span class="p">,</span>
                               <span class="n">label_columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">label_columns</span><span class="p">,</span>
                               <span class="n">definitions</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">definitions</span><span class="p">,</span>
                               <span class="n">group_by_label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">group_by_label</span><span class="p">,</span>
                               <span class="n">height</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
                               <span class="n">widgets</span><span class="o">=</span><span class="n">widgets</span><span class="p">,</span>
                               <span class="n">appbuilder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="p">)</span></div>


<div class="viewcode-block" id="DirectByChartView"><a class="viewcode-back" href="../../../api.html#flask.ext.appbuilder.charts.views.DirectByChartView">[docs]</a><span class="k">class</span> <span class="nc">DirectByChartView</span><span class="p">(</span><span class="n">GroupByChartView</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Use this class to display charts with multiple series,</span>
<span class="sd">        based on columns or methods defined on models.</span>
<span class="sd">        You can display multiple charts on the same view.</span>

<span class="sd">        Default routing point is &#39;/chart&#39;</span>

<span class="sd">        Setup definitions property to configure the chart</span>

<span class="sd">        :label: (optional) String label to display on chart selection.</span>
<span class="sd">        :group: String with the column name or method from model.</span>
<span class="sd">        :formatter: (optional) function that formats the output of &#39;group&#39; key</span>
<span class="sd">        :series: A list of tuples with the aggregation function and the column name</span>
<span class="sd">                to apply the aggregation</span>

<span class="sd">        The **definitions** property respects the following grammar::</span>

<span class="sd">            definitions = [</span>
<span class="sd">                    {</span>
<span class="sd">                     &#39;label&#39;: &#39;label for chart definition&#39;,</span>
<span class="sd">                     &#39;group&#39;: &#39;&lt;COLNAME&gt;&#39;|&#39;&lt;MODEL FUNCNAME&gt;&#39;,</span>
<span class="sd">                     &#39;formatter&#39;: &lt;FUNC FORMATTER FOR GROUP COL&gt;,</span>
<span class="sd">                     &#39;series&#39;: [&#39;&lt;COLNAME&gt;&#39;|&#39;&lt;MODEL FUNCNAME&gt;&#39;,...]</span>
<span class="sd">                    }, ...</span>
<span class="sd">                  ]</span>

<span class="sd">        example::</span>

<span class="sd">            class CountryDirectChartView(DirectByChartView):</span>
<span class="sd">                datamodel = SQLAInterface(CountryStats)</span>
<span class="sd">                chart_title = &#39;Direct Data Example&#39;</span>

<span class="sd">                definitions = [</span>
<span class="sd">                    {</span>
<span class="sd">                        &#39;label&#39;: &#39;Unemployment&#39;,</span>
<span class="sd">                        &#39;group&#39;: &#39;stat_date&#39;,</span>
<span class="sd">                        &#39;series&#39;: [&#39;unemployed_perc&#39;,</span>
<span class="sd">                            &#39;college_perc&#39;]</span>
<span class="sd">                    }</span>
<span class="sd">                ]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ProcessClass</span> <span class="o">=</span> <span class="n">DirectProcessData</span></div>


<span class="c1">#-------------------------------------------------------</span>
<span class="c1"># DEPRECATED SECTION</span>
<span class="c1">#-------------------------------------------------------</span>

<span class="k">class</span> <span class="nc">BaseSimpleGroupByChartView</span><span class="p">(</span><span class="n">BaseChartView</span><span class="p">):</span>
    <span class="n">group_by_columns</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="sd">&quot;&quot;&quot; A list of columns to be possibly grouped by, this list must be filled &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_by_columns</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Base Chart View property &lt;group_by_columns&gt; must not be empty&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">BaseSimpleGroupByChartView</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_chart_widget</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                          <span class="n">order_column</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                          <span class="n">order_direction</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                          <span class="n">widgets</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                          <span class="n">group_by</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                          <span class="n">height</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                          <span class="o">**</span><span class="n">args</span><span class="p">):</span>

        <span class="n">height</span> <span class="o">=</span> <span class="n">height</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span>
        <span class="n">widgets</span> <span class="o">=</span> <span class="n">widgets</span> <span class="ow">or</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">group_by</span> <span class="o">=</span> <span class="n">group_by</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_by_columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">joined_filters</span> <span class="o">=</span> <span class="n">filters</span><span class="o">.</span><span class="n">get_joined_filters</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_base_filters</span><span class="p">)</span>
        <span class="n">value_columns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">datamodel</span><span class="o">.</span><span class="n">query_simple_group</span><span class="p">(</span><span class="n">group_by</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="n">joined_filters</span><span class="p">)</span>

        <span class="n">widgets</span><span class="p">[</span><span class="s1">&#39;chart&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_widget</span><span class="p">(</span><span class="n">route_base</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">route_base</span><span class="p">,</span>
                                             <span class="n">chart_title</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_title</span><span class="p">,</span>
                                             <span class="n">chart_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span><span class="p">,</span>
                                             <span class="n">chart_3d</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_3d</span><span class="p">,</span>
                                             <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
                                             <span class="n">value_columns</span><span class="o">=</span><span class="n">value_columns</span><span class="p">,</span>
                                             <span class="n">modelview_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span>
                                             <span class="o">**</span><span class="n">args</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">widgets</span>


<span class="k">class</span> <span class="nc">BaseSimpleDirectChartView</span><span class="p">(</span><span class="n">BaseChartView</span><span class="p">):</span>
    <span class="n">direct_columns</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make chart using the column on the dict</span>
<span class="sd">        chart_columns = {&#39;chart label 1&#39;:(&#39;X column&#39;,&#39;Y1 Column&#39;,&#39;Y2 Column, ...),</span>
<span class="sd">                        &#39;chart label 2&#39;: (&#39;X Column&#39;,&#39;Y1 Column&#39;,...),...}</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">direct_columns</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Base Chart View property &lt;direct_columns&gt; must not be empty&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">BaseSimpleDirectChartView</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">get_group_by_columns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            returns the keys from direct_columns</span>
<span class="sd">            Used in template, so that user can choose from options</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">direct_columns</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">_get_chart_widget</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                          <span class="n">order_column</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                          <span class="n">order_direction</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                          <span class="n">widgets</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                          <span class="n">direct</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                          <span class="n">height</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                          <span class="o">**</span><span class="n">args</span><span class="p">):</span>

        <span class="n">height</span> <span class="o">=</span> <span class="n">height</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span>
        <span class="n">widgets</span> <span class="o">=</span> <span class="n">widgets</span> <span class="ow">or</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">joined_filters</span> <span class="o">=</span> <span class="n">filters</span><span class="o">.</span><span class="n">get_joined_filters</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_base_filters</span><span class="p">)</span>
        <span class="n">count</span><span class="p">,</span> <span class="n">lst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">datamodel</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">filters</span><span class="o">=</span><span class="n">joined_filters</span><span class="p">,</span>
                                          <span class="n">order_column</span><span class="o">=</span><span class="n">order_column</span><span class="p">,</span>
                                          <span class="n">order_direction</span><span class="o">=</span><span class="n">order_direction</span><span class="p">)</span>
        <span class="n">value_columns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">datamodel</span><span class="o">.</span><span class="n">get_values</span><span class="p">(</span><span class="n">lst</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">direct</span><span class="p">))</span>
        <span class="n">value_columns</span> <span class="o">=</span> <span class="n">dict_to_json</span><span class="p">(</span><span class="n">direct</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">direct</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_columns</span><span class="p">,</span> <span class="n">value_columns</span><span class="p">)</span>

        <span class="n">widgets</span><span class="p">[</span><span class="s1">&#39;chart&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_widget</span><span class="p">(</span><span class="n">route_base</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">route_base</span><span class="p">,</span>
                                             <span class="n">chart_title</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_title</span><span class="p">,</span>
                                             <span class="n">chart_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span><span class="p">,</span>
                                             <span class="n">chart_3d</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_3d</span><span class="p">,</span>
                                             <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
                                             <span class="n">value_columns</span><span class="o">=</span><span class="n">value_columns</span><span class="p">,</span>
                                             <span class="n">modelview_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span>
                                             <span class="o">**</span><span class="n">args</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">widgets</span>


<div class="viewcode-block" id="ChartView"><a class="viewcode-back" href="../../../api.html#flask.ext.appbuilder.charts.views.ChartView">[docs]</a><span class="k">class</span> <span class="nc">ChartView</span><span class="p">(</span><span class="n">BaseSimpleGroupByChartView</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        **DEPRECATED**</span>

<span class="sd">        Provides a simple (and hopefully nice) way to draw charts on your application.</span>

<span class="sd">        This will show Google Charts based on group by of your tables.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@expose</span><span class="p">(</span><span class="s1">&#39;/chart/&lt;group_by&gt;&#39;</span><span class="p">)</span>
    <span class="nd">@expose</span><span class="p">(</span><span class="s1">&#39;/chart/&#39;</span><span class="p">)</span>
    <span class="nd">@has_access</span>
    <span class="k">def</span> <span class="nf">chart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group_by</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="n">form</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_form</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
        <span class="n">get_filter_args</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filters</span><span class="p">)</span>

        <span class="n">group_by</span> <span class="o">=</span> <span class="n">group_by</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_by_columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">widgets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_chart_widget</span><span class="p">(</span><span class="n">filters</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_filters</span><span class="p">,</span> <span class="n">group_by</span><span class="o">=</span><span class="n">group_by</span><span class="p">)</span>
        <span class="n">widgets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_search_widget</span><span class="p">(</span><span class="n">form</span><span class="o">=</span><span class="n">form</span><span class="p">,</span> <span class="n">widgets</span><span class="o">=</span><span class="n">widgets</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">render_template</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_template</span><span class="p">,</span> <span class="n">route_base</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">route_base</span><span class="p">,</span>
                               <span class="n">title</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_title</span><span class="p">,</span>
                               <span class="n">label_columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">label_columns</span><span class="p">,</span>
                               <span class="n">group_by_columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">group_by_columns</span><span class="p">,</span>
                               <span class="n">group_by_label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">group_by_label</span><span class="p">,</span>
                               <span class="n">height</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
                               <span class="n">widgets</span><span class="o">=</span><span class="n">widgets</span><span class="p">,</span>
                               <span class="n">appbuilder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="p">)</span></div>


<div class="viewcode-block" id="TimeChartView"><a class="viewcode-back" href="../../../api.html#flask.ext.appbuilder.charts.views.TimeChartView">[docs]</a><span class="k">class</span> <span class="nc">TimeChartView</span><span class="p">(</span><span class="n">BaseSimpleGroupByChartView</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        **DEPRECATED**</span>

<span class="sd">        Provides a simple way to draw some time charts on your application.</span>

<span class="sd">        This will show Google Charts based on count and group by month and year for your tables.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">chart_template</span> <span class="o">=</span> <span class="s1">&#39;appbuilder/general/charts/chart_time.html&#39;</span>
    <span class="n">chart_type</span> <span class="o">=</span> <span class="s1">&#39;ColumnChart&#39;</span>


    <span class="k">def</span> <span class="nf">_get_chart_widget</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                          <span class="n">order_column</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                          <span class="n">order_direction</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                          <span class="n">widgets</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                          <span class="n">group_by</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                          <span class="n">period</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                          <span class="n">height</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                          <span class="o">**</span><span class="n">args</span><span class="p">):</span>

        <span class="n">height</span> <span class="o">=</span> <span class="n">height</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span>
        <span class="n">widgets</span> <span class="o">=</span> <span class="n">widgets</span> <span class="ow">or</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">group_by</span> <span class="o">=</span> <span class="n">group_by</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_by_columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">joined_filters</span> <span class="o">=</span> <span class="n">filters</span><span class="o">.</span><span class="n">get_joined_filters</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_base_filters</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">period</span> <span class="o">==</span> <span class="s1">&#39;month&#39;</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">period</span><span class="p">:</span>
            <span class="n">value_columns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">datamodel</span><span class="o">.</span><span class="n">query_month_group</span><span class="p">(</span><span class="n">group_by</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="n">joined_filters</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">period</span> <span class="o">==</span> <span class="s1">&#39;year&#39;</span><span class="p">:</span>
            <span class="n">value_columns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">datamodel</span><span class="o">.</span><span class="n">query_year_group</span><span class="p">(</span><span class="n">group_by</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="n">joined_filters</span><span class="p">)</span>

        <span class="n">widgets</span><span class="p">[</span><span class="s1">&#39;chart&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_widget</span><span class="p">(</span><span class="n">route_base</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">route_base</span><span class="p">,</span>
                                             <span class="n">chart_title</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_title</span><span class="p">,</span>
                                             <span class="n">chart_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span><span class="p">,</span>
                                             <span class="n">chart_3d</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_3d</span><span class="p">,</span>
                                             <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
                                             <span class="n">value_columns</span><span class="o">=</span><span class="n">value_columns</span><span class="p">,</span>
                                             <span class="n">modelview_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span>
                                             <span class="o">**</span><span class="n">args</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">widgets</span>


    <span class="nd">@expose</span><span class="p">(</span><span class="s1">&#39;/chart/&lt;group_by&gt;/&lt;period&gt;&#39;</span><span class="p">)</span>
    <span class="nd">@expose</span><span class="p">(</span><span class="s1">&#39;/chart/&#39;</span><span class="p">)</span>
    <span class="nd">@has_access</span>
    <span class="k">def</span> <span class="nf">chart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group_by</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="n">form</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_form</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
        <span class="n">get_filter_args</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filters</span><span class="p">)</span>

        <span class="n">group_by</span> <span class="o">=</span> <span class="n">group_by</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_by_columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">widgets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_chart_widget</span><span class="p">(</span><span class="n">filters</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_filters</span><span class="p">,</span>
                                         <span class="n">group_by</span><span class="o">=</span><span class="n">group_by</span><span class="p">,</span>
                                         <span class="n">period</span><span class="o">=</span><span class="n">period</span><span class="p">,</span>
                                         <span class="n">height</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>

        <span class="n">widgets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_search_widget</span><span class="p">(</span><span class="n">form</span><span class="o">=</span><span class="n">form</span><span class="p">,</span> <span class="n">widgets</span><span class="o">=</span><span class="n">widgets</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">render_template</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_template</span><span class="p">,</span> <span class="n">route_base</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">route_base</span><span class="p">,</span>
                               <span class="n">title</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_title</span><span class="p">,</span>
                               <span class="n">label_columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">label_columns</span><span class="p">,</span>
                               <span class="n">group_by_columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">group_by_columns</span><span class="p">,</span>
                               <span class="n">group_by_label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">group_by_label</span><span class="p">,</span>
                               <span class="n">widgets</span><span class="o">=</span><span class="n">widgets</span><span class="p">,</span>
                               <span class="n">appbuilder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="p">)</span></div>


<div class="viewcode-block" id="DirectChartView"><a class="viewcode-back" href="../../../api.html#flask.ext.appbuilder.charts.views.DirectChartView">[docs]</a><span class="k">class</span> <span class="nc">DirectChartView</span><span class="p">(</span><span class="n">BaseSimpleDirectChartView</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        **DEPRECATED**</span>

<span class="sd">        This class is responsible for displaying a Google chart with</span>
<span class="sd">        direct model values. Chart widget uses json.</span>
<span class="sd">        No group by is processed, example::</span>

<span class="sd">            class StatsChartView(DirectChartView):</span>
<span class="sd">                datamodel = SQLAInterface(Stats)</span>
<span class="sd">                chart_title = lazy_gettext(&#39;Statistics&#39;)</span>
<span class="sd">                direct_columns = {&#39;Some Stats&#39;: (&#39;X_col_1&#39;, &#39;stat_col_1&#39;, &#39;stat_col_2&#39;),</span>
<span class="sd">                                  &#39;Other Stats&#39;: (&#39;X_col2&#39;, &#39;stat_col_3&#39;)}</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">chart_type</span> <span class="o">=</span> <span class="s1">&#39;ColumnChart&#39;</span>

    <span class="n">chart_widget</span> <span class="o">=</span> <span class="n">DirectChartWidget</span>

    <span class="nd">@expose</span><span class="p">(</span><span class="s1">&#39;/chart/&lt;group_by&gt;&#39;</span><span class="p">)</span>
    <span class="nd">@expose</span><span class="p">(</span><span class="s1">&#39;/chart/&#39;</span><span class="p">)</span>
    <span class="nd">@has_access</span>
    <span class="k">def</span> <span class="nf">chart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group_by</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="n">form</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_form</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
        <span class="n">get_filter_args</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filters</span><span class="p">)</span>

        <span class="n">direct_key</span> <span class="o">=</span> <span class="n">group_by</span> <span class="ow">or</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">direct_columns</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">direct</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">direct_columns</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">direct_key</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_order</span><span class="p">:</span>
            <span class="n">order_column</span><span class="p">,</span> <span class="n">order_direction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_order</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">order_column</span><span class="p">,</span> <span class="n">order_direction</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span>

        <span class="n">widgets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_chart_widget</span><span class="p">(</span><span class="n">filters</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_filters</span><span class="p">,</span>
                                         <span class="n">order_column</span><span class="o">=</span><span class="n">order_column</span><span class="p">,</span>
                                         <span class="n">order_direction</span><span class="o">=</span><span class="n">order_direction</span><span class="p">,</span>
                                         <span class="n">direct</span><span class="o">=</span><span class="n">direct</span><span class="p">)</span>
        <span class="n">widgets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_search_widget</span><span class="p">(</span><span class="n">form</span><span class="o">=</span><span class="n">form</span><span class="p">,</span> <span class="n">widgets</span><span class="o">=</span><span class="n">widgets</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">render_template</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_template</span><span class="p">,</span> <span class="n">route_base</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">route_base</span><span class="p">,</span>
                               <span class="n">title</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_title</span><span class="p">,</span>
                               <span class="n">label_columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">label_columns</span><span class="p">,</span>
                               <span class="n">group_by_columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_group_by_columns</span><span class="p">(),</span>
                               <span class="n">group_by_label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">group_by_label</span><span class="p">,</span>
                               <span class="n">height</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
                               <span class="n">widgets</span><span class="o">=</span><span class="n">widgets</span><span class="p">,</span>
                               <span class="n">appbuilder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="p">)</span></div>


</pre></div>

    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2013, Daniel Vaz Gaspar.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.1.<br/>
    </p>
  </div>
</footer>
  </body>
</html>